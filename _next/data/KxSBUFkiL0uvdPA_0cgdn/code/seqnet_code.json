{"pageProps":{"codeData":{"content":"<h1>SeqNet: Learning Descriptors for Sequence-Based Hierarchical Place Recognition</h1>\n<p>[<a href=\"https://arxiv.org/abs/2102.11603\">ArXiv+Supplementary</a>] [<a href=\"https://ieeexplore.ieee.org/abstract/document/9382076/\">IEEE Xplore RA-L 2021</a>] [<a href=\"https://www.youtube.com/watch?v=KYw7RhDfxY0\">ICRA 2021 YouTube Video</a>]</p>\n<p><strong>and</strong></p>\n<h1>SeqNetVLAD vs PointNetVLAD: Image Sequence vs 3D Point Clouds for Day-Night Place Recognition</h1>\n<p>[<a href=\"https://arxiv.org/abs/2106.11481\">ArXiv</a>] [<a href=\"https://sites.google.com/view/cvpr2021-3d-vision-robotics/\">CVPR 2021 Workshop 3DVR</a>]</p>\n<p align=\"center\">\n  <picture><img alt=\"\" src=\"https:/github.com/oravus/seqNet/raw/HEAD/assets/seqnet.jpg\"></picture>\n    <br><em>Sequence-Based Hierarchical Visual Place Recognition.</em>\n</p>\n<h2>News:</h2>\n<p><strong>Jan 27, 2024</strong> : Download all pretrained models from <a href=\"https://universityofadelaide.box.com/s/mp45yapl0j0by6aijf5kj8obt8ky0swk\">here</a>, Nordland dataset from <a href=\"https://universityofadelaide.box.com/s/zkfk1akpbo5318fzqmtvlpp7030ex4up\">here</a> and precomputed descriptors from <a href=\"https://universityofadelaide.box.com/s/p8uh5yncsaxk7g8lwr8pihnwkqbc2pkf\">here</a></p>\n<p><strong>Jan 18, 2022</strong> : MSLS training setup included.</p>\n<p><strong>Jan 07, 2022</strong> : Single Image Vanilla NetVLAD feature extraction enabled.</p>\n<p><strong>Oct 13, 2021</strong> : <s>Oxford &amp; Brisbane Day-Night pretrained models <a href=\"https://cloudstor.aarnet.edu.au/plus/s/wx0zIGi3WBTtq5F\">download link</a>.</s> (use the latest link provided above)</p>\n<p><strong>Aug 03, 2021</strong> : Added Oxford dataset files <s>and a <a href=\"https://cloudstor.aarnet.edu.au/plus/s/8L7loyTZjK0FsWT\">direct link</a> to download the Nordland dataset.</s> (use the latest link provided above)</p>\n<p><strong>Jun 23, 2021</strong>: CVPR 2021 Workshop 3DVR paper, \"SeqNetVLAD vs PointNetVLAD\", now available on <a href=\"https://arxiv.org/abs/2106.11481\">arXiv</a>.</p>\n<h2>Setup</h2>\n<h3>Conda</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">conda create <span class=\"token parameter variable\">-n</span> seqnet numpy <span class=\"token assign-left variable\">pytorch</span><span class=\"token operator\">=</span><span class=\"token number\">1.8</span>.0 torchvision tqdm scikit-learn faiss tensorboardx h5py <span class=\"token parameter variable\">-c</span> pytorch <span class=\"token parameter variable\">-c</span> conda-forge\n</code></pre>\n<h3>Download</h3>\n<p><s>Run <code>bash download.sh</code> to download single image NetVLAD descriptors (3.4 GB) for the Nordland-clean dataset <sup><a href=\"#nordclean\">[a]</a></sup> and the Oxford dataset (0.3 GB), and Nordland-trained model files (1.5 GB) <sup><a href=\"#saveLoc\">[b]</a></sup>. Other pre-trained models for Oxford and Brisbane Day-Night can be downloaded from <a href=\"https://universityofadelaide.box.com/s/mp45yapl0j0by6aijf5kj8obt8ky0swk\">here</a>.</s> [Please see download links at the top news from 27 Jan 2024]</p>\n<h2>Run</h2>\n<h3>Train</h3>\n<p>To train sequential descriptors through SeqNet on the Nordland dataset:</p>\n<pre class=\"language-python\"><code class=\"language-python\">python main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode train <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling seqnet <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sw <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">10</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>w <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>outDims <span class=\"token number\">4096</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>expName <span class=\"token string\">\"w5\"</span>\n</code></pre>\n<p>or the Oxford dataset (set <code>--dataset oxford-pnv</code> for pointnetvlad-like data split as described in the <a href=\"https://arxiv.org/abs/2106.11481\">CVPR 2021 Workshop paper</a>):</p>\n<pre class=\"language-python\"><code class=\"language-python\">python main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode train <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling seqnet <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset oxford<span class=\"token operator\">-</span>v1<span class=\"token punctuation\">.</span><span class=\"token number\">0</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>w <span class=\"token number\">3</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>outDims <span class=\"token number\">4096</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>expName <span class=\"token string\">\"w3\"</span>\n</code></pre>\n<p>or the MSLS dataset (specifying <code>--msls_trainCity</code> and <code>--msls_valCity</code> as default values):</p>\n<pre class=\"language-python\"><code class=\"language-python\">python main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode train <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling seqnet <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset msls <span class=\"token operator\">-</span><span class=\"token operator\">-</span>msls_trainCity melbourne <span class=\"token operator\">-</span><span class=\"token operator\">-</span>msls_valCity austin <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>w <span class=\"token number\">3</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>outDims <span class=\"token number\">4096</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>expName <span class=\"token string\">\"msls_w3\"</span>\n</code></pre>\n<p>To train transformed single descriptors through SeqNet:</p>\n<pre class=\"language-python\"><code class=\"language-python\">python main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode train <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling seqnet <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sw <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">1</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>w <span class=\"token number\">1</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>outDims <span class=\"token number\">4096</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>expName <span class=\"token string\">\"w1\"</span>\n</code></pre>\n<h3>Test</h3>\n<p>On the Nordland dataset:</p>\n<pre class=\"language-python\"><code class=\"language-python\">python main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling seqnet <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>resume <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>runs<span class=\"token operator\">/</span>Jun03_15<span class=\"token operator\">-</span><span class=\"token number\">22</span><span class=\"token operator\">-</span>44_l10_w5<span class=\"token operator\">/</span> \n</code></pre>\n<p>On the MSLS dataset (can change <code>--msls_valCity</code> to <code>melbourne</code> or <code>austin</code> too):</p>\n<pre class=\"language-python\"><code class=\"language-python\">python main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling seqnet <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset msls <span class=\"token operator\">-</span><span class=\"token operator\">-</span>msls_valCity amman <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>resume <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>runs<span class=\"token operator\">/</span><span class=\"token operator\">&lt;</span>modelName<span class=\"token operator\">&gt;</span><span class=\"token operator\">/</span>\n</code></pre>\n<p>The above will reproduce results for SeqNet (S5) as per <a href=\"https://arxiv.org/pdf/2102.11603.pdf\">Supp. Table III on Page 10</a>.</p>\n<details>\n  <summary> [Expand this] To obtain other results from the same table in the paper, expand this. </summary>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Raw Single (NetVLAD) Descriptor</span>\npython main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling single <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">1</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test\n\n<span class=\"token comment\"># SeqNet (S1)</span>\npython main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling seqnet <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">1</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>resume <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>runs<span class=\"token operator\">/</span>Jun03_15<span class=\"token operator\">-</span><span class=\"token number\">07</span><span class=\"token operator\">-</span>46_l1_w1<span class=\"token operator\">/</span>\n\n<span class=\"token comment\"># Raw + Smoothing</span>\npython main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling smooth <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test\n\n<span class=\"token comment\"># Raw + Delta</span>\npython main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling delta <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test\n\n<span class=\"token comment\"># Raw + SeqMatch</span>\npython main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling single<span class=\"token operator\">+</span>seqmatch <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test\n\n<span class=\"token comment\"># SeqNet (S1) + SeqMatch</span>\npython main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling s1<span class=\"token operator\">+</span>seqmatch <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>resume <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>runs<span class=\"token operator\">/</span>Jun03_15<span class=\"token operator\">-</span><span class=\"token number\">07</span><span class=\"token operator\">-</span>46_l1_w1<span class=\"token operator\">/</span>\n\n<span class=\"token comment\"># HVPR (S5 to S1)</span>\n<span class=\"token comment\"># Run S5 first and save its predictions by specifying `resultsPath`</span>\npython main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling seqnet <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>resume <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>runs<span class=\"token operator\">/</span>Jun03_15<span class=\"token operator\">-</span><span class=\"token number\">22</span><span class=\"token operator\">-</span>44_l10_w5<span class=\"token operator\">/</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>resultsPath <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>results<span class=\"token operator\">/</span>\n<span class=\"token comment\"># Now run S1 + SeqMatch using results from above (the timestamp of `predictionsFile` would be different in your case)</span>\npython main<span class=\"token punctuation\">.</span>py <span class=\"token operator\">-</span><span class=\"token operator\">-</span>mode test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>pooling s1<span class=\"token operator\">+</span>seqmatch <span class=\"token operator\">-</span><span class=\"token operator\">-</span>dataset nordland<span class=\"token operator\">-</span>sf <span class=\"token operator\">-</span><span class=\"token operator\">-</span>seqL <span class=\"token number\">5</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>split test <span class=\"token operator\">-</span><span class=\"token operator\">-</span>resume <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>runs<span class=\"token operator\">/</span>Jun03_15<span class=\"token operator\">-</span><span class=\"token number\">07</span><span class=\"token operator\">-</span>46_l1_w1<span class=\"token operator\">/</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>predictionsFile <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>results<span class=\"token operator\">/</span>Jun03_16<span class=\"token operator\">-</span><span class=\"token number\">07</span><span class=\"token operator\">-</span>36_l5_0<span class=\"token punctuation\">.</span>npz\n\n</code></pre>\n</details>\n<h3>Single Image Vanilla NetVLAD Extraction</h3>\n<details>\n<summary> [Expand this] To obtain the single image vanilla NetVLAD descriptors (i.e. the provided precomputed .npy descriptors) </summary>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Setup Patch-NetVLAD submodule from the seqNet repo:</span>\n<span class=\"token builtin class-name\">cd</span> seqNet \n<span class=\"token function\">git</span> submodule update <span class=\"token parameter variable\">--init</span>\n\n<span class=\"token comment\"># Download NetVLAD+PCA model</span>\n<span class=\"token builtin class-name\">cd</span> thirdparty/Patch-NetVLAD/patchnetvlad/pretrained_models\n<span class=\"token function\">wget</span> <span class=\"token parameter variable\">-O</span> pitts_orig_WPCA4096.pth.tar https://huggingface.co/TobiasRobotics/Patch-NetVLAD/resolve/main/pitts_WPCA4096.pth.tar?download<span class=\"token operator\">=</span>true\n\n<span class=\"token comment\"># Compute global descriptors</span>\n<span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/Patch-NetVLAD/\npython feature_extract.py <span class=\"token parameter variable\">--config_path</span> patchnetvlad/configs/seqnet.ini <span class=\"token parameter variable\">--dataset_file_path</span> <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/structFiles/imageNamesFiles/oxford_2014-12-16-18-44-24_imagenames_subsampled-2m.txt <span class=\"token parameter variable\">--dataset_root_dir</span> <span class=\"token operator\">&lt;</span>PATH_TO_OXFORD_IMAGE_DIR<span class=\"token operator\">&gt;</span> <span class=\"token parameter variable\">--output_features_fullpath</span> <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/data/descData/netvlad-pytorch/oxford_2014-12-16-18-44-24_stereo_left.npy\n\n<span class=\"token comment\"># example for MSLS (replace 'database' with 'query' and use different city names to compute all)</span>\npython feature_extract.py <span class=\"token parameter variable\">--config_path</span> patchnetvlad/configs/seqnet.ini <span class=\"token parameter variable\">--dataset_file_path</span> <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/structFiles/imageNamesFiles/msls_melbourne_database_imageNames.txt <span class=\"token parameter variable\">--dataset_root_dir</span> <span class=\"token operator\">&lt;</span>PATH_TO_Mapillary_Street_Level_Sequences<span class=\"token operator\">&gt;</span> <span class=\"token parameter variable\">--output_features_fullpath</span> <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/data/descData/netvlad-pytorch/msls_melbourne_database.npy\n</code></pre>\n</details>\n<h2>Acknowledgement</h2>\n<p>The code in this repository is based on <a href=\"https://github.com/Nanne/pytorch-NetVlad\">Nanne/pytorch-NetVlad</a>. Thanks to <a href=\"https://github.com/Tobias-Fischer\">Tobias Fischer</a> for his contributions to this code during the development of our project <a href=\"https://github.com/QVPR/Patch-NetVLAD\">QVPR/Patch-NetVLAD</a>.</p>\n<h2>Citation</h2>\n<pre><code>@article{garg2021seqnet,\n  title={SeqNet: Learning Descriptors for Sequence-based Hierarchical Place Recognition},\n  author={Garg, Sourav and Milford, Michael},\n  journal={IEEE Robotics and Automation Letters},\n  volume={6},\n  number={3},\n  pages={4305-4312},\n  year={2021},\n  publisher={IEEE},\n  doi={10.1109/LRA.2021.3067633}\n}\n\n@misc{garg2021seqnetvlad,\n  title={SeqNetVLAD vs PointNetVLAD: Image Sequence vs 3D Point Clouds for Day-Night Place Recognition},\n  author={Garg, Sourav and Milford, Michael},\n  howpublished={CVPR 2021 Workshop on 3D Vision and Robotics (3DVR)},\n  month={Jun},\n  year={2021},\n}\n</code></pre>\n<h4>Other Related Projects</h4>\n<p><a href=\"https://github.com/oravus/SeqMatchNet\">SeqMatchNet (2021)</a>;\n<a href=\"https://github.com/QVPR/Patch-NetVLAD\">Patch-NetVLAD (2021)</a>;\n<a href=\"https://github.com/oravus/DeltaDescriptors\">Delta Descriptors (2020)</a>;\n<a href=\"https://github.com/oravus/CoarseHash\">CoarseHash (2020)</a>;\n<a href=\"https://github.com/oravus/seq2single\">seq2single (2019)</a>;\n<a href=\"https://github.com/oravus/lostX\">LoST (2018)</a></p>\n<p><a name=\"nordclean\">[a]</a><a> This is the clean version of the dataset that excludes images from the tunnels and red lights and can be downloaded from </a><a href=\"https://universityofadelaide.app.box.com/s/zkfk1akpbo5318fzqmtvlpp7030ex4up\">here</a>.</p>\n<p><a name=\"saveLoc\">[b]</a><a> These will automatically save to <code>./data/</code>, you can modify this path in </a><a href=\"https://github.com/oravus/seqNet/blob/main/download.sh\">download.sh</a> and <a href=\"https://github.com/oravus/seqNet/blob/5450829c4294fe1d14966bfa1ac9b7c93237369b/get_datasets.py#L6\">get_datasets.py</a> to specify your workdir.</p>\n","name":"SeqNet","type":"code","url":"https://github.com/oravus/seqNet","id":"seqnet_code","image":"./assets/seqnet.jpg","_images":["/_next/static/images/seqnet-cfc1aecd3cd2b268af41400a4fb86e6a.jpg.webp","/_next/static/images/seqnet-69de71978f2b7f0ffbcefcbb976010d3.jpg"],"src":"/content/visual_place_recognition/seqnet.md","image_position":"center"}},"__N_SSG":true}